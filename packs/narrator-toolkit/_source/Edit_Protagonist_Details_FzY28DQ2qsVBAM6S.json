{
  "name": "Edit Protagonist Details",
  "type": "script",
  "scope": "global",
  "author": "U772esq9FbrkahYQ",
  "img": "icons/svg/heal.svg",
  "command": "//*Narrator's Toolbox - Edit Protagonist Details*//\nif (!game.user.isGM) {\n\tui.notifications.warn(\"You must be a Narrator to use this macro.\");\n\treturn;\n}\nlet actors = game.actors.contents.filter((a) => a.type === \"Protagonist\");\nlet dialogContent = `<form>\n<div class=\"style-form\">To be used to edit a Protagonists's Name, Player, Gender, Life, Experience and Destiny<br><br></div>\n<div class=\"style-form\">Note that 'Player Name' needs to be the same as under Settings - 'User Management', for the buttons to appear in the Chat<br><br></div>\n<div class=\"style-form\">To make the 'Finalize Premade Protagonist' button appear in the Summary Tab, set the New Protagonist Name to include either 'Premade' or 'Protagonist'<br><br></div>\n<div class=\"form-group style-form\">\n\t<div class=\"style-form\">Protagonist Name</div>\n\t<div class=\"style-form\">New Protagonist Name</div>\n\t<div class=\"style-form\">New Player Name</div>\n\t<div class=\"style-form\">New Gender</div>\n\t<div class=\"style-form\">New Life Current</div>\n\t<div class=\"style-form\">New Total Experience</div>\n\t<div class=\"style-form\">New Current Destiny</div>\n</div>\n`;\nfor (let actor of actors) {\n\tdialogContent += `<div class=\"form-group\">\n\t\t\t<div class=\"style-form\">${actor.name}</div>\n\t\t\t<div class=\"style-form\"><input type=\"text\" name=\"newName-${actor.id}\" value=\"${actor.name}\"></div>\n\t\t\t<div class=\"style-form\"><input type=\"text\" name=\"newPlayer-${actor.id}\" value=\"${actor.system.metaowner.value}\"></div>\n\t\t\t<div class=\"style-form\"><input type=\"text\" name=\"newGender-${actor.id}\" value=\"${actor.system.humanoids.gender.value}\"></div>\n\t\t\t<div class=\"style-form\"><input type=\"number\" dtype=\"Number\" name=\"life-${actor.id}\" value=\"${actor.system.Vital.Life.value}\"></div>\n\t\t\t<div class=\"style-form\"><input type=\"number\" name=\"totalExperience-${actor.id}\" value=\"${actor.system.Vital.Experience.Total}\"></div>\n\t\t\t<div class=\"style-form\"><input type=\"number\" name=\"currentDestiny-${actor.id}\" value=\"${actor.system.Vital.Destiny.value}\"></div>\n\t\t</div>`;\n}\ndialogContent += `</form><br><br>`;\ndialogContent += `<div>Confirming will make the new Current Destiny also the Max Destiny for each Protagonist</div><br><br>`;\nlet dialogOptions = {\n\twidth: 1000,\n\theight: 520,\n\tresizable: true,\n};\nlet toolboxdialog = new Dialog(\n\t{\n\t\ttitle: \"Narrator's Toolbox - Edit Protagonist Details\",\n\t\tcontent: dialogContent,\n\t\tbuttons: {\n\t\t\tok: {\n\t\t\t\tlabel: \"Confirm\",\n\t\t\t\tcallback: async (html) => {\n\t\t\t\t\tfor (let actor of actors) {\n\t\t\t\t\t\tlet totalExperience = html.find(`[name=\"totalExperience-${actor.id}\"]`).val();\n\t\t\t\t\t\tlet currentDestiny = html.find(`[name=\"currentDestiny-${actor.id}\"]`).val();\n\t\t\t\t\t\tlet maxDestiny = currentDestiny;\n\t\t\t\t\t\tlet newName = html.find(`[name=\"newName-${actor.id}\"]`).val();\n\t\t\t\t\t\tlet newPlayer = html.find(`[name=\"newPlayer-${actor.id}\"]`).val();\n\t\t\t\t\t\tlet newGender = html.find(`[name=\"newGender-${actor.id}\"]`).val();\n\t\t\t\t\t\tlet life = html.find(`[name=\"life-${actor.id}\"]`).val();\n\t\t\t\t\t\tawait actor.update({\n\t\t\t\t\t\t\tname: newName,\n\t\t\t\t\t\t\t\"system.metaowner.value\": newPlayer,\n\t\t\t\t\t\t\t\"system.humanoids.gender.value\": newGender,\n\t\t\t\t\t\t\t\"system.Vital.Experience.Total\": totalExperience,\n\t\t\t\t\t\t\t\"system.Vital.Destiny.value\": currentDestiny,\n\t\t\t\t\t\t\t\"system.Vital.Destiny.max\": maxDestiny,\n\t\t\t\t\t\t\t\"prototypeToken.name\": newName,\n\t\t\t\t\t\t\t\"system.Vital.Life.value\": life,\n\t\t\t\t\t\t});\n\t\t\t\t\t}\n\t\t\t\t},\n\t\t\t},\n\t\t\tcancel: {\n\t\t\t\tlabel: \"Cancel\",\n\t\t\t},\n\t\t},\n\t\tdefault: \"ok\",\n\t},\n\tdialogOptions\n);\ntoolboxdialog.render(true);",
  "folder": null,
  "ownership": {
    "default": 0,
    "U772esq9FbrkahYQ": 3
  },
  "flags": {
    "advanced-macros": {
      "runForSpecificUser": ""
    },
    "core": {},
    "scene-packer": {
      "sourceId": "Macro.YrbH2jPSarowsD5K",
      "hash": "9222af40fc516d38534d8db5fa4d265d086864e5"
    }
  },
  "_stats": {
    "systemId": "metanthropes-system",
    "systemVersion": "0.8.85",
    "coreVersion": "11.315",
    "createdTime": 1693073514715,
    "modifiedTime": 1700756840927,
    "lastModifiedBy": "yjFY5zW9urDSuce5"
  },
  "_id": "FzY28DQ2qsVBAM6S",
  "sort": 200000,
  "_key": "!macros!FzY28DQ2qsVBAM6S"
}
